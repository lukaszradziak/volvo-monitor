var O=Object.defineProperty,H=Object.defineProperties;var q=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var $=(e,t,s)=>t in e?O(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,v=(e,t)=>{for(var s in t||(t={}))V.call(t,s)&&$(e,s,t[s]);if(B)for(var s of B(t))z.call(t,s)&&$(e,s,t[s]);return e},M=(e,t)=>H(e,q(t));import{j as jsx,a as jsxs,D as Disclosure,F as Fragment,N as NavLink,X as XIcon,M as MenuIcon,O as Outlet,u as useLocalStorage,I as InformationCircleIcon,T as Transition,r as react,b as Dialog,c as useInterval,d as useForm,C as Controller,S as StarIcon,e as StarIcon$1,P as PencilAltIcon,f as TrashIcon,g as Switch,h as ChevronDoubleLeftIcon,i as ChevronLeftIcon,k as ChevronRightIcon,l as ChevronDoubleRightIcon,m as Menu,n as ChevronDownIcon,o as reactDom,H as HashRouter,R as Routes,p as Route}from"./vendor.js";const p=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const n of l.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function s(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerpolicy&&(l.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?l.credentials="include":a.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(a){if(a.ep)return;a.ep=!0;const l=s(a);fetch(a.href,l)}};p();const Main=({children:e})=>jsx("main",{className:"bg-gray-100 flex-1",children:jsx("div",{className:"max-w-7xl mx-auto py-6 px-4",children:e})}),Footer=()=>jsxs("footer",{className:"bg bg-white text-center p-8 text-gray-400",children:["Volvo Monitor ",new Date().getFullYear()]}),navigation=[{name:"Home",href:"/"},{name:"Monitor",href:"/monitor"},{name:"Sniffer",href:"/sniffer"},{name:"Parameters",href:"/parameters"},{name:"Settings",href:"/settings"}],Header$1=()=>jsx(Disclosure,{as:"nav",className:"bg-primary-600",children:({open:e,close:t})=>jsxs(Fragment,{children:[jsx("div",{className:"max-w-7xl mx-auto px-2 sm:px-4 lg:px-8",children:jsxs("div",{className:"relative flex items-center justify-between h-16",children:[jsxs("div",{className:"flex items-center px-2 lg:px-0",children:[jsx("div",{className:"flex-shrink-0",children:jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"white",children:jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),jsx("div",{className:"hidden lg:block lg:ml-6",children:jsx("div",{className:"flex space-x-4",children:navigation.map(s=>jsx(NavLink,{to:s.href,className:({isActive:r})=>`${r?"bg-primary-700 text-white":"text-gray-300"}  hover:bg-primary-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium `,children:s.name},s.name))})})]}),jsx("div",{className:"flex lg:hidden",children:jsxs(Disclosure.Button,{className:"inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary",children:[jsx("span",{className:"sr-only",children:"Open main menu"}),e?jsx(XIcon,{className:"block h-6 w-6","aria-hidden":"true"}):jsx(MenuIcon,{className:"block h-6 w-6","aria-hidden":"true"})]})})]})}),jsx(Disclosure.Panel,{className:"lg:hidden",children:jsx("div",{className:"px-2 pt-2 pb-3 space-y-1",children:navigation.map(s=>jsx(NavLink,{to:s.href,className:({isActive:r})=>`${r?"bg-primary-700 text-white":"text-gray-300"}  text-gray-300 hover:bg-primary-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium`,onClick:t,children:s.name},s.name))})})]})}),App=()=>jsxs("div",{className:"flex flex-col min-h-screen",children:[jsx(Header$1,{}),jsx(Main,{children:jsx(Outlet,{})}),jsx(Footer,{})]}),useSettings=()=>useLocalStorage("settings",{interval:"100",canSpeed:"250",canAddress:"7A",canInterval:"04"}),timeout=e=>{let t=new AbortController;return setTimeout(()=>t.abort(),e),t},Api=async(e,t=null,s={timeout:5e3})=>{let r;return t&&(r=new FormData,Object.keys(t).forEach(n=>r.append(n,t[n]))),await(await fetch(`http://192.168.4.1/api/${e}`,{signal:timeout(s.timeout).signal,method:t?"POST":"GET",body:r})).text()},Alert=({type:e="info",title:t,message:s})=>{const a={info:{bg:"bg-blue-50",text:"text-blue-800",border:"border-blue-100"},error:{bg:"bg-red-50",text:"text-red-800",border:"border-red-100"},success:{bg:"bg-green-50",text:"text-green-800",border:"border-green-100"}}[e];return jsx("div",{className:`rounded-md ${a.bg} p-4 border ${a.border} mb-4`,children:jsxs("div",{className:"flex items-center",children:[jsx("div",{className:"flex-shrink-0",children:jsx(InformationCircleIcon,{className:`h-5 w-5 ${a.text}`,"aria-hidden":"true"})}),jsxs("div",{className:"flex items-center ml-3",children:[jsx("h3",{className:`text-sm font-medium ${a.text}`,children:t}),jsx("div",{className:`mt-2 text-sm ${a.text}`,children:s})]})]})})},Badge=({type:e="info",children:t})=>{const r={success:{bg:"bg-green-100",text:"text-green-800"},error:{bg:"bg-red-100",text:"text-red-800"},info:{bg:"bg-blue-100",text:"text-blue-800"},warning:{bg:"bg-yellow-100",text:"text-yellow-800"}}[e];return jsx("span",{className:`mr-2 mb-2 inline-flex items-center px-2.5 py-0.5 rounded-md text-sm font-medium ${r.bg} ${r.text}`,children:t})},Button=e=>{const t={default:{text:"text-black",bg:"bg-stone-200",bgHover:"hover:bg-stone-300",hover:"focus:ring-stone-300"},primary:{text:"text-white",bg:"bg-primary-600",bgHover:"hover:bg-primary-700",hover:"focus:ring-primary-500"},red:{text:"text-white",bg:"bg-red-600",bgHover:"hover:bg-red-700",hover:"focus:ring-red-500"}},s=t[e.color]||t.default;return jsx("button",M(v({className:`mr-2 mb-2 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md ${s.text} ${s.bg} ${s.bgHover} ${s.focus} focus:outline-none focus:ring-2 focus:ring-offset-2`},e),{children:e.children}))},Header=e=>jsx("h2",M(v({className:"block text-sm text-gray-700 font-bold"},e),{children:e.children})),Modal=({open:e=!0,onClose:t=()=>{},children:s=null})=>jsx(Transition.Root,{show:e,as:react.exports.Fragment,children:jsx(Dialog,{as:"div",className:"fixed z-10 inset-0 overflow-y-auto",onClose:t,children:jsxs("div",{className:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[jsx(Transition.Child,{as:react.exports.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:jsx(Dialog.Overlay,{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"})}),jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"\u200B"}),jsx(Transition.Child,{as:react.exports.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",enterTo:"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0 sm:scale-100",leaveTo:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",children:jsx("div",{className:"max-w-2xl inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:p-6",children:s})})]})})}),unitNames={40:"CEM",50:"CEM","7A":"ECM"},Home=()=>{const[e]=useSettings(),[t,s]=react.exports.useState(!1),[r,a]=react.exports.useState([]),[l,n]=react.exports.useState(""),u=async()=>{n("Loading..."),a([]),s(!0);const m=await Api("dtc/read",{canSpeed:e.canSpeed,canAddress:parseInt(e.canAddress,16)});n("");const f=m.match(/EE\,1B\,(.*?),(.*?)\,00/g).map(b=>b.replace("EE,1B,","").split(",")).map(b=>b[0]+b[1]);a(f)},o=async()=>{n("Loading..."),a([]),s(!0),await Api("dtc/clear",{canSpeed:e.canSpeed,canAddress:parseInt(e.canAddress,16)})==="ok"&&n("Success")},c=m=>{const f=unitNames[e.canAddress]||"";return(f?`${f}-`:"")+m};return jsxs(Fragment,{children:[jsx(Header,{children:"Volvo Monitor"}),jsxs("div",{className:"py-4",children:[jsxs(Button,{onClick:u,children:["Read DTC (",e.canAddress,")"]}),jsxs(Button,{onClick:o,children:["Clear DTC (",e.canAddress,")"]})]}),jsxs(Modal,{open:t,onClose:()=>s(!t),children:[l?jsx(Alert,{title:l,type:"info"}):null,r.map((m,f)=>jsx("div",{children:jsx(Badge,{type:"error",children:jsx("a",{href:`https://www.dtcdecode.com/Volvo/${c(m)}`,target:"_blank",children:c(m)})})},f))]})]})},useParameters=()=>useLocalStorage("parameters",[]),DownloadFile=(e,t,s="text/plain")=>{const r=new Blob([e],{type:s}),a=URL.createObjectURL(r),l=document.createElement("a");l.href=a,l.setAttribute("download",t),l.click()},evaluateEval=(definition,variable)=>(definition=definition.replaceAll("x&0b","x & 0x"),eval(`((x) => ${definition||"x"})(${variable})`)),ParseFrame=(e,t)=>{if(!t)return{};const s={hex:"",value:"",calc:"",success:!1};if(t.size)for(let r=0;r<parseInt(t.size)/8;r++)e[6+r]&&(s.hex+=e[7+r]);return e[4]==="E6"&&(s.success=!0),s.value=parseInt(s.hex,16),s.calc=evaluateEval(t.definition,s.value),s},Monitor$1=()=>{const[e]=useSettings(),[t]=useParameters(),[s,r]=react.exports.useState([]),[a,l]=react.exports.useState([]),[n,u]=react.exports.useState(!1),[o,c]=react.exports.useState(!1),m=async()=>{const j=Object.fromEntries(t.filter(i=>i.active).map((i,d)=>[`param${d}`,parseInt(i.address,16)]));await Api("monitor/start",v({canSpeed:e.canSpeed,canAddress:parseInt(e.canAddress,16),canInterval:parseInt(e.canInterval)},j))},f=async()=>{await Api("monitor/stop",{})},b=async()=>await Api("data"),C=()=>t.filter(j=>j.active),w=j=>{const i=C();a.length!==i.length&&i.forEach((d,h)=>{a[h]=0}),j.split(`
`).forEach(d=>{const h=d.split(","),R=h[5]+h[6],L=h[0],k=i.findIndex(E=>E.address==R),F=i[k];if(k===-1)return;const P=ParseFrame(h,F);a[k]=P.calc,s.push({time:L,actual:[...a]})}),l(a),r(s)};useInterval(async()=>{c(!0),e.canInterval==="01"&&await m();const j=await b();w(j),c(!1)},n&&!o?e.interval:null),react.exports.useEffect(()=>()=>{f()},[]);const N=async()=>{await m(),u(!0)},A=async()=>{u(!1),await f()},S=()=>{r([]),l([])},I=()=>{const i=`TIME,${C().map((d,h)=>d.name||`p${h}`).join(",")}
`+s.map(d=>`${(d.time-s[0].time)/1e3},${d.actual.join(",")}`).join(`
`);DownloadFile(i,"logger.csv","text/csv")};return jsxs(Fragment,{children:[jsxs("div",{children:[jsx(Button,{onClick:()=>N(),color:n?null:"primary",children:"Start"}),jsx(Button,{onClick:()=>A(),color:n?"primary":null,children:"Stop"}),jsx(Button,{onClick:()=>S(),children:"Clear"}),jsx(Button,{onClick:()=>I(),children:"Download"})]}),jsxs("p",{className:"mb-2",children:["Length: ",s.length]}),C().map((j,i)=>jsxs("div",{className:"mb-2 bg-white shadow overflow-hidden sm:rounded-lg border p-2 flex justify-between items-center",children:[jsxs("div",{children:[jsxs(Header,{children:[j.name," (",j.address,")"]}),jsxs("p",{children:[j.description.slice(0,15)," ",j.description.length>=15?"...":null]})]}),jsxs("div",{className:"flex flex-col",children:[jsx("div",{className:"flex justify-end",children:jsx(Badge,{children:jsx("span",{className:"text-2xl",children:parseFloat(a[i]||0).toFixed(2)})})}),jsxs("div",{className:"flex justify-end",children:[jsx(Badge,{type:"success",children:jsx("span",{className:"text-xs",children:"0"})})," ",jsx(Badge,{type:"error",children:jsx("span",{className:"text-xs",children:"0"})})]})]})]},i))]})},Label=e=>jsxs("label",M(v({className:"block text-sm font-medium text-gray-700"},e),{children:[e.children,e.required?jsx("span",{className:"text-red-700",children:" *"}):null]})),Input=e=>jsx("input",v({className:"mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm mb-4"},e)),SnifferMessage=({onSubmit:e=()=>{}})=>{const t=[...new Array(8)].map((n,u)=>u),{control:s,handleSubmit:r,formState:{errors:a}}=useForm({defaultValues:v({address:"0FFFFE"},Object.fromEntries(t.map(n=>[`data${n}`,"00"])))});return jsxs("form",{onSubmit:r(n=>{const u=Object.fromEntries(Object.keys(n).map(o=>[o,parseInt(n[o],16)]));e(u)}),className:"mb-4",children:[Object.keys(a).length?jsx(Alert,{type:"error",title:"Fill required fields"}):null,jsx(Label,{required:!0,children:"Address"}),jsx(Controller,{name:"address",control:s,rules:{required:!0},render:({field:{onChange:n,onBlur:u,value:o}})=>jsx(Input,{onChange:n,onBlur:u,value:o})}),jsx("div",{className:"grid grid-cols-4 md:grid-cols-8 gap-2",children:t.map(n=>jsxs("div",{children:[jsxs(Label,{required:!0,children:["Data ",n]}),jsx(Controller,{name:`data${n}`,control:s,rules:{required:!0},render:({field:{onChange:u,onBlur:o,value:c}})=>jsx(Input,{onChange:u,onBlur:o,value:c})})]},n))}),jsx(Button,{type:"submit",children:"Send"})]})},Monitor=()=>{const{control:e,getValues:t}=useForm({defaultValues:{limitFrames:"0",filterACR0:"0",filterACR1:"0",filterACR2:"0",filterACR3:"0",filterAMR0:"ff",filterAMR1:"ff",filterAMR2:"ff",filterAMR3:"ff",softFilterId:""}}),[s]=useSettings(),[r,a]=react.exports.useState(!1),[l,n]=react.exports.useState(!1),[u,o]=react.exports.useState([]),c=async()=>{await Api("sniffer/start",{canSpeed:s.canSpeed,filterACR0:parseInt(t("filterACR0"),16),filterACR1:parseInt(t("filterACR1"),16),filterACR2:parseInt(t("filterACR2"),16),filterACR3:parseInt(t("filterACR3"),16),filterAMR0:parseInt(t("filterAMR0"),16),filterAMR1:parseInt(t("filterAMR1"),16),filterAMR2:parseInt(t("filterAMR2"),16),filterAMR3:parseInt(t("filterAMR3"),16)})},m=async()=>{await Api("sniffer/stop",{})},f=async()=>await Api("data"),b=i=>i.trim().split(`
`).filter(d=>d).map(d=>d.split(",")),C=()=>{const i=parseInt(t("limitFrames")||"0");return isNaN(i)?1:i};useInterval(async()=>{n(!0);const i=await f(),d=b(i);o(h=>[...h,...d]),n(!1)},r&&!l?s.interval:null),react.exports.useEffect(()=>()=>{m()},[]);const w=async()=>{await c(),a(!0)},N=async()=>{a(!1),await m()},A=()=>{o([])},S=()=>{const i=u.map(d=>d.join(",")).join(`
`);DownloadFile(i,"sniffer.csv","text/csv")},I=async i=>{r||await w(),a(!1),await Api("sniffer/message",i),a(!0)},j=i=>t("softFilterId")?i[1].search(t("softFilterId"))!==-1:!0;return jsxs(Fragment,{children:[jsxs("div",{children:[jsx(Header,{children:"Settings"}),jsx(Label,{children:"Hardware Filter"}),jsxs("div",{className:"grid grid-cols-4 md:grid-cols-8 gap-2 mt-2",children:[jsxs("div",{children:[jsx(Label,{children:"ACR0"}),jsx(Controller,{name:"filterACR0",control:e,render:({field:{onChange:i,onBlur:d,value:h}})=>jsx(Input,{onChange:i,onBlur:d,value:h})})]}),jsxs("div",{children:[jsx(Label,{children:"ACR1"}),jsx(Controller,{name:"filterACR1",control:e,render:({field:{onChange:i,onBlur:d,value:h}})=>jsx(Input,{onChange:i,onBlur:d,value:h})})]}),jsxs("div",{children:[jsx(Label,{children:"ACR2"}),jsx(Controller,{name:"filterACR2",control:e,render:({field:{onChange:i,onBlur:d,value:h}})=>jsx(Input,{onChange:i,onBlur:d,value:h})})]}),jsxs("div",{children:[jsx(Label,{children:"ACR3"}),jsx(Controller,{name:"filterACR3",control:e,render:({field:{onChange:i,onBlur:d,value:h}})=>jsx(Input,{onChange:i,onBlur:d,value:h})})]}),jsxs("div",{children:[jsx(Label,{children:"AMR0"}),jsx(Controller,{name:"filterAMR0",control:e,render:({field:{onChange:i,onBlur:d,value:h}})=>jsx(Input,{onChange:i,onBlur:d,value:h})})]}),jsxs("div",{children:[jsx(Label,{children:"AMR1"}),jsx(Controller,{name:"filterAMR1",control:e,render:({field:{onChange:i,onBlur:d,value:h}})=>jsx(Input,{onChange:i,onBlur:d,value:h})})]}),jsxs("div",{children:[jsx(Label,{children:"AMR2"}),jsx(Controller,{name:"filterAMR2",control:e,render:({field:{onChange:i,onBlur:d,value:h}})=>jsx(Input,{onChange:i,onBlur:d,value:h})})]}),jsxs("div",{children:[jsx(Label,{children:"AMR3"}),jsx(Controller,{name:"filterAMR3",control:e,render:({field:{onChange:i,onBlur:d,value:h}})=>jsx(Input,{onChange:i,onBlur:d,value:h})})]})]}),jsx(Label,{children:"Limit frames"}),jsx(Controller,{name:"limitFrames",control:e,render:({field:{onChange:i,onBlur:d,value:h}})=>jsx(Input,{onChange:i,onBlur:d,value:h})}),jsx(Label,{children:"Soft Filter ID"}),jsx(Controller,{name:"softFilterId",control:e,render:({field:{onChange:i,onBlur:d,value:h}})=>jsx(Input,{onChange:i,onBlur:d,value:h})}),jsx(Header,{children:"Send Message"}),jsx(SnifferMessage,{onSubmit:I}),jsx(Button,{onClick:()=>w(),color:r?null:"primary",children:"Start"}),jsx(Button,{onClick:()=>N(),color:r?"primary":null,children:"Stop"}),jsx(Button,{onClick:()=>A(),children:"Clear"}),jsx(Button,{onClick:()=>S(),children:"Download CSV"})]}),jsxs("div",{children:[jsxs(Header,{children:["Sniffer (",u.length,")"]}),jsx("div",{children:u.filter(j).slice(-C()).map((i,d)=>jsx("div",{children:JSON.stringify(i)},d))})]})]})},Parameter=({data:e,onToggleActive:t=()=>{},onEdit:s=()=>{},onRemove:r=()=>{},onTest:a=()=>{}})=>jsx(Fragment,{children:jsxs("div",{className:` mb-6 bg-white shadow overflow-hidden sm:rounded-lg border ${e.active?"border-2 border-primary-400":""}`,children:[jsxs("div",{className:"px-4 py-4 sm:px-6 flex justify-between items-center",children:[jsx("div",{children:jsxs("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:[e.name," (",e.address,")"]})}),jsxs("div",{className:"flex items-center",children:[jsx(Button,{onClick:t,color:e.active?"primary":"default",children:e.active?jsx(StarIcon,{className:"h-4 w-4"}):jsx(StarIcon$1,{className:"h-4 w-4"})}),jsx(Button,{onClick:s,children:jsx(PencilAltIcon,{className:"h-4 w-4"})}),jsx(Button,{onClick:r,children:jsx(TrashIcon,{className:"h-4 w-4"})})]})]}),jsxs("div",{className:"border-t border-gray-200 px-4 py-5 sm:px-6",children:[e.description?jsx("p",{className:"mb-4",children:e.description}):null,jsx(Badge,{children:e.definition||"-"}),jsx(Badge,{type:"error",children:e.unit||"-"}),jsx(Badge,{type:"success",children:e.size}),jsx(Badge,{type:"warning",children:e.max?`${e.min} / ${e.max}`:"-"}),jsx("button",{className:"mr-2 inline-flex justify-center py-1 px-4 border border-transparent shadow-sm text-xs font-medium rounded-md bg-gray-100",onClick:()=>a(e),children:"Test"})]})]})}),Checkbox=({checked:e=!1,onChange:t=()=>{},onBlur:s=()=>{}})=>{const[r,a]=react.exports.useState(e);return jsx("div",{className:"pt-2 pb-4",children:jsxs(Switch,{checked:r,onChange:n=>{a(n),t(n)},onBlur:s,className:`${r?"bg-indigo-600":"bg-gray-200"} relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500`,children:[jsx("span",{className:"sr-only",children:"Use setting"}),jsx("span",{"aria-hidden":"true",className:`
            ${r?"translate-x-5":"translate-x-0"}
            pointer-events-none inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition ease-in-out duration-200`})]})})},Select=e=>jsx("select",M(v({className:"mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm mb-4"},e),{children:e.options.map(t=>jsx("option",{value:t.value,children:t.label},t.value))})),Textarea=e=>jsx("textarea",v({className:"mb-2 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border border-gray-300 rounded-md"},e)),ParameterForm=({onSubmit:e,editData:t=null})=>{const s=t||{address:"",name:"",description:"",size:"8",definition:"",unit:"",min:"",max:"",active:!1},{control:r,handleSubmit:a,reset:l,formState:{errors:n}}=useForm({defaultValues:s});return jsxs("form",{onSubmit:a(o=>{e(o),l()}),className:"mb-4",children:[t?jsx("h2",{children:"Edit"}):null,Object.keys(n).length?jsx(Alert,{type:"error",title:"Fill required fields"}):null,jsx(Label,{required:!0,children:"Address"}),jsx(Controller,{name:"address",control:r,rules:{required:!0},render:({field:{onChange:o,onBlur:c,value:m}})=>jsx(Input,{onChange:o,onBlur:c,value:m})}),jsx(Label,{children:"Name"}),jsx(Controller,{name:"name",control:r,render:({field:{onChange:o,onBlur:c,value:m}})=>jsx(Input,{onChange:o,onBlur:c,value:m})}),jsx(Label,{children:"Description"}),jsx(Controller,{name:"description",control:r,render:({field:{onChange:o,onBlur:c,value:m}})=>jsx(Textarea,{onChange:o,onBlur:c,value:m})}),jsx(Label,{required:!0,children:"Size"}),jsx(Controller,{name:"size",control:r,rules:{required:!0},render:({field:{onChange:o,onBlur:c,value:m}})=>jsx(Select,{onChange:o,onBlur:c,value:m,options:[{value:"8",label:"8"},{value:"16",label:"16"}]})}),jsxs("div",{className:"grid grid-cols-2 gap-2",children:[jsxs("div",{children:[jsx(Label,{children:"Definition"}),jsx(Controller,{name:"definition",control:r,render:({field:{onChange:o,onBlur:c,value:m}})=>jsx(Input,{onChange:o,onBlur:c,value:m})})]}),jsxs("div",{children:[jsx(Label,{children:"Unit"}),jsx(Controller,{name:"unit",control:r,render:({field:{onChange:o,onBlur:c,value:m}})=>jsx(Input,{onChange:o,onBlur:c,value:m})})]})]}),jsxs("div",{className:"grid grid-cols-2 gap-2",children:[jsxs("div",{children:[jsx(Label,{children:"Minimum"}),jsx(Controller,{name:"min",control:r,render:({field:{onChange:o,onBlur:c,value:m}})=>jsx(Input,{onChange:o,onBlur:c,value:m})})]}),jsxs("div",{children:[jsx(Label,{children:"Maximum"}),jsx(Controller,{name:"max",control:r,render:({field:{onChange:o,onBlur:c,value:m}})=>jsx(Input,{onChange:o,onBlur:c,value:m})})]})]}),jsx(Label,{children:"Active"}),jsx(Controller,{name:"active",control:r,render:({field:{onChange:o,onBlur:c,value:m}})=>jsx(Checkbox,{onChange:o,onBlur:c,checked:m})}),jsx(Button,{type:"submit",children:t?"Update":"Create"})]})},Pagination=({page:e=1,pages:t=10,maxVisible:s=3,onChange:r=()=>{}})=>{const[a,l]=react.exports.useState([]),[n,u]=react.exports.useState(1);react.exports.useEffect(()=>{const c=[];for(let m=n-s;m<=n+s;m++)m>=1&&m<=t&&c.push(m);l(c)},[t,n]),react.exports.useEffect(()=>{u(e)},[e]);const o=c=>{n!==c&&(u(c),r(c))};return jsx("div",{className:"flex justify-center",children:jsxs("nav",{className:"select-none relative flex rounded-md -space-x-px","aria-label":"Pagination",children:[jsx("a",{onClick:()=>o(1),className:"cursor-pointer relative inline-flex items-center px-1 py-2 sm:px-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50",children:jsx(ChevronDoubleLeftIcon,{className:"h-4 w-4","aria-hidden":"true"})}),jsx("a",{onClick:()=>o(n>1?n-1:1),className:"cursor-pointer relative inline-flex items-center px-1 py-2 sm:px-4 border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50",children:jsx(ChevronLeftIcon,{className:"h-4 w-4","aria-hidden":"true"})}),a.map(c=>jsx("a",{onClick:()=>o(c),"aria-current":"page",className:`${c==n?"z-10 bg-indigo-50 border-indigo-500 text-indigo-600":""} cursor-pointer bg-white border-gray-300 text-gray-500 hover:bg-gray-50 relative inline-flex items-center px-2 py-2 sm:px-4 border text-sm font-medium `,children:c},c)),jsx("a",{onClick:()=>o(n<t?n+1:t),className:"cursor-pointer relative inline-flex items-center px-1 py-2 sm:px-4 border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50",children:jsx(ChevronRightIcon,{className:"h-4 w-4","aria-hidden":"true"})}),jsx("a",{onClick:()=>o(t),className:"cursor-pointer relative inline-flex items-center px-1 py-2 sm:px-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50",children:jsx(ChevronDoubleRightIcon,{className:"h-4 w-4","aria-hidden":"true"})})]})})},Paginator=({perPage:e=20,items:t=[],render:s=()=>{},scrollable:r=!1})=>{const a=react.exports.useRef(null),[l,n]=react.exports.useState([]),[u,o]=react.exports.useState(1),c=Math.ceil(t.length/e);react.exports.useEffect(()=>{const f=t.slice((u-1)*e,e*u);n(f)},[t,u]),react.exports.useEffect(()=>{o(1)},[t]);const m=f=>{o(f),r&&window.scrollTo({top:0,behavior:"smooth"})};return jsxs("div",{ref:a,children:[l.map((f,b)=>jsx("div",{children:s(f,b)},b)),l.length?null:jsx("div",{className:"text-gray-700 text-sm",children:"Not found"}),c&&c>1?jsx(Pagination,{page:u,pages:c,onChange:f=>m(f)}):null]})},Dropdown=({options:e})=>jsxs(Menu,{as:"div",className:"relative inline-block text-left",children:[jsx("div",{children:jsxs(Menu.Button,{className:"inline-flex justify-center w-full rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-100 focus:ring-indigo-500",children:["Options",jsx(ChevronDownIcon,{className:"-mr-1 ml-2 h-5 w-5","aria-hidden":"true"})]})}),jsx(Transition,{as:react.exports.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:jsx(Menu.Items,{className:"origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none",children:jsx("div",{className:"py-1",children:e.map(({label:t,onClick:s=()=>{}},r)=>jsx(Menu.Item,{children:()=>jsx("a",{className:"cursor-pointer text-gray-700 block px-4 py-2 text-sm hover:bg-gray-100",onClick:s,children:t})},r))})})})]}),scriptRel="modulepreload",seen={},base="/volvo-monitor/",__vitePreload=function e(t,s){return!s||s.length===0?t():Promise.all(s.map(r=>{if(r=`${base}${r}`,r in seen)return;seen[r]=!0;const a=r.endsWith(".css"),l=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${l}`))return;const n=document.createElement("link");if(n.rel=a?"stylesheet":scriptRel,a||(n.as="script",n.crossOrigin=""),n.href=r,document.head.appendChild(n),a)return new Promise((u,o)=>{n.addEventListener("load",u),n.addEventListener("error",o)})})).then(()=>t())},files={"../../data/CEM_P2_MY02_08688381__A.csv":()=>__vitePreload(()=>import("./CEM_P2_MY02_08688381__A.js"),[]),"../../data/ECM_P2_MY02_08658507__H.csv":()=>__vitePreload(()=>import("./ECM_P2_MY02_08658507__H.js"),[])},basename=e=>e.split("/").reverse()[0],ParameterSample=({onLoad:e})=>{const t=async s=>{const a=(await files[s]()).default.map(l=>({address:l[0],name:l[1],description:l[2],size:l[3],definition:l[4],unit:l[5],min:String(parseFloat(l[6])),max:String(parseFloat(l[7])),active:!1}));e(a)};return jsx("div",{className:"flex flex-col",children:Object.keys(files).map((s,r)=>jsx(Button,{onClick:()=>t(s),children:basename(s)},r))})},ParameterTest=({data:e})=>{var s;const t=r=>r===1?"error":r===2||r===5||r===6?"info":r===7||r===8||r===9?"success":"warning";return jsx("div",{children:((s=e.data)==null?void 0:s.length)?jsxs("div",{className:"pt-2",children:[e.parse.success?jsx(Alert,{title:"Success",type:"success"}):jsx(Alert,{title:"Error response",type:"error"}),jsxs(Header,{children:[e.parameter.name," (",e.parameter.address,")"]}),jsx("p",{children:e.parameter.description}),jsx("div",{className:"py-4",children:e.data.map((r,a)=>jsx(Badge,{type:t(a),children:r},a))}),jsx(Header,{children:"Parse"}),jsx("div",{children:jsxs(Badge,{children:["HEX: ",e.parse.hex]})}),jsx("div",{children:jsxs(Badge,{children:["Value: ",e.parse.value]})}),jsx("div",{children:jsx(Badge,{type:"success",children:jsx("span",{className:"font-bold text-xl",children:e.parse.calc})})})]}):jsx(Alert,{title:"Connecting...",type:"info"})})},Parameters=()=>{const[e]=useSettings(),[t,s]=useParameters(),[r,a]=react.exports.useState([]),[l,n]=react.exports.useState(!1),[u,o]=react.exports.useState(!1),[c,m]=react.exports.useState(null),[f,b]=react.exports.useState(!1),[C,w]=react.exports.useState(!1),[N,A]=react.exports.useState({}),[S,I]=react.exports.useState(""),[j,i]=react.exports.useState(""),[d,h]=react.exports.useState(null);react.exports.useEffect(()=>{let x=t.map((g,y)=>({item:g,index:y}));if(S){const g=S.toLowerCase();x=x.filter(({item:y})=>String(y.name).toLowerCase().indexOf(g)!==-1||String(y.description).toLowerCase().indexOf(g)!==-1||String(y.address).toLowerCase().indexOf(g)!==-1)}j&&(x=x.filter(({item:g})=>g.unit===j)),d&&(x=x.filter(({item:g})=>d==="1"?g.active:!g.active)),a(x)},[t,S,j,d]);const R=x=>{s(x),b(!1)},L=x=>{s([...t,x]),n(!1)},k=x=>{t[x].active=!t[x].active,s(t)},F=x=>{o(!0),m(x)},P=x=>{t[c]=x,s(t),o(!1),m(null)},E=x=>{t.splice(x,1),s(t)},_=async x=>{A({});const y=(await Api("monitor/test",{canSpeed:e.canSpeed,canAddress:parseInt(e.canAddress,16),address:parseInt(x.address,16)})).split(",").filter(T=>T),D=ParseFrame(y,x);w(!0),A({parameter:x,data:y,parse:D})};return jsxs("div",{children:[jsxs("div",{className:"mb-4 flex justify-between",children:[jsx(Button,{color:"primary",onClick:()=>n(!0),children:"Create"}),jsx(Dropdown,{options:[{label:"Upload",onClick:()=>console.log("Upload")},{label:"Download",onClick:()=>console.log("Download")},{label:"Load Sample",onClick:()=>b(!0)}]})]}),jsxs("div",{className:"mb-4",children:[jsx(Label,{children:"Search"}),jsx("div",{className:"mt-1",children:jsx(Input,{placeholder:"Search...",onChange:x=>I(x.target.value)})})]}),jsxs("div",{className:"grid grid-cols-2 gap-2 mb-4",children:[jsxs("div",{children:[jsx(Label,{children:"Active"}),jsx("div",{className:"mt-1",children:jsx(Select,{options:[{label:"All",value:""},{label:`Active (${t.filter(x=>x.active).length})`,value:"1"},{label:`Inactive (${t.filter(x=>!x.active).length})`,value:"0"}],onChange:x=>h(x.target.value)})})]}),jsxs("div",{children:[jsx(Label,{children:"Unit"}),jsx("div",{className:"mt-1",children:jsx(Select,{options:[...new Set(t.map(x=>x.unit))].map(x=>({label:x||"All",value:x})),onChange:x=>i(x.target.value)})})]})]}),jsx("div",{className:"mb-2",children:jsxs(Header,{children:["Parameters (",r.length,")"]})}),jsx(Paginator,{scrollable:!0,items:r,render:({item:x,index:g})=>jsx(Fragment,{children:jsx(Parameter,{data:x,onToggleActive:()=>k(g),onEdit:()=>F(g),onRemove:()=>E(g),onTest:()=>_(x)},g)})}),jsx(Modal,{open:l,onClose:()=>n(!1),children:jsx(ParameterForm,{onSubmit:L})}),jsx(Modal,{open:u,onClose:()=>o(!1),children:jsx(ParameterForm,{onSubmit:P,editData:t[c]})}),jsx(Modal,{open:f,onClose:()=>b(!1),children:jsx(ParameterSample,{onLoad:R})}),jsxs(Modal,{open:C,onClose:()=>w(!1),children:[jsx(Button,{onClick:()=>_(N.parameter),children:"Reload"}),jsx(ParameterTest,{data:N})]})]})},Settings=()=>{const[e,t]=useSettings(),{control:s,handleSubmit:r}=useForm({defaultValues:e});return jsxs("form",{onSubmit:r(l=>{t(l)}),children:[jsx(Label,{required:!0,children:"Monitor Interval"}),jsx(Controller,{name:"interval",control:s,render:({field:{onChange:l,onBlur:n,value:u}})=>jsx(Input,{onChange:l,onBlur:n,value:u})}),jsx(Label,{required:!0,children:"CAN Speed"}),jsx(Controller,{name:"canSpeed",control:s,render:({field:{onChange:l,onBlur:n,value:u}})=>jsx(Select,{onChange:l,onBlur:n,value:u,options:[{value:"125",label:"125 kbps"},{value:"250",label:"250 kbps"},{value:"500",label:"500 kbps"}]})}),jsx(Label,{required:!0,children:"CAN Address (CEM: 50, ECM: 7A)"}),jsx(Controller,{name:"canAddress",control:s,render:({field:{onChange:l,onBlur:n,value:u}})=>jsx(Input,{onChange:l,onBlur:n,value:u})}),jsx(Label,{required:!0,children:"CAN Interval"}),jsx(Controller,{name:"canInterval",control:s,render:({field:{onChange:l,onBlur:n,value:u}})=>jsx(Select,{onChange:l,onBlur:n,value:u,options:[{value:"01",label:"01 - once"},{value:"02",label:"02 - slow"},{value:"03",label:"03 - medium"},{value:"04",label:"04 - fast"}]})}),jsx(Button,{type:"submit",color:"primary",children:"Save"})]})};var style="";reactDom.exports.render(jsx(HashRouter,{children:jsx(Routes,{children:jsxs(Route,{path:"/",element:jsx(App,{}),children:[jsx(Route,{index:!0,element:jsx(Home,{})}),jsx(Route,{path:"monitor",element:jsx(Monitor$1,{})}),jsx(Route,{path:"sniffer",element:jsx(Monitor,{})}),jsx(Route,{path:"parameters",element:jsx(Parameters,{})}),jsx(Route,{path:"settings",element:jsx(Settings,{})})]})})}),document.getElementById("root"));
